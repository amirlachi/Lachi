@using Lachi.Areas.Admin.Models.User
@using Lachi.Models.Common
@model PagedResult<UserDto>
@{
    ViewData["Title"] = "لیست کاربران";
    var queryParams = Context.Request.Query.ToDictionary(k => k.Key, v => v.Value.ToString());
}

<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header pb-0">
                <h6>جدول کاربران</h6>
                <a class="btn btn-success" href="/admin/user/create">کاربر جدید +</a>
            </div>
            <div class="card-body px-0 pt-0 pb-2">
                <div class="table-responsive p-0">
                    <table class="table align-items-center mb-0">
                        <thead>
                            <tr>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">نام کاربری</th>
                                <th class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">تعداد ویدئو های آپلودی</th>
                                <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">وضعیت</th>
                                <th class="text-center text-uppercase text-secondary text-xxs font-weight-bolder opacity-7">تاریخ ثبت</th>
                                <th class="text-secondary opacity-7"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Items)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex px-2 py-1">
                                            <div>
                                                <img src="~/admintemplate/assets/img/team-2.jpg" class="avatar avatar-sm me-3" alt="user1">
                                            </div>
                                            <div class="d-flex flex-column justify-content-center">
                                                <h6 class="mb-0 text-sm">@item.UserName</h6>
                                                <p class="text-xs text-secondary mb-0">@(item.FullName??"وارد نشده")</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="text-secondary text-xs font-weight-bold">@item.UploadedVideoCounts</span>
                                        @* <p class="text-xs font-weight-bold mb-0">@item.UploadedVideoCounts</p>
                                        <p class="text-xs text-secondary mb-0">Organization</p> *@
                                    </td>
                                    <td class="align-middle text-center text-sm">
                                        <span class="badge badge-sm @(item.IsActive ? "bg-gradient-success" : "bg-gradient-secondary") ">@(item.IsActive?"فعال": "غیرفعال")</span>
                                    </td>
                                    <td class="align-middle text-center">
                                        <span class="text-secondary text-xs font-weight-bold">@item.CreateAt.ToString("yyyy/MM/dd")</span>
                                    </td>
                                    <td class="align-middle">
                                        @* <a href="javascript:;" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="View">
                                            جزئیات
                                        </a> *@
                                        <a href="javascript:;" class="text-secondary font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Edit">
                                            ویرایش
                                        </a>
                                        @* <a href="javascript:;" class="text-danger font-weight-bold text-xs" data-toggle="tooltip" data-original-title="Delete">
                                            حذف
                                        </a> *@
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        @* Pagination *@
        <div class="card card-frame mt-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        صفحه <strong>@Model.CurrentPage</strong> از <strong>@Model.TotalPages</strong>
                    </div>
                    <div>
                        تعداد کل آیتم‌ها: <strong>@Model.TotalItems</strong>
                    </div>
                </div>

                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-primary justify-content-center">

                        <!-- Previous -->
                        <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                            @{
                                queryParams["page"] = (Model.CurrentPage - 1).ToString();
                                var prevUrl = "?" + string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={kvp.Value}"));
                            }
                            <a class="page-link" href="@(Model.CurrentPage == 1 ? "#" : prevUrl)" aria-label="Previous">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>

                        <!-- Numbered pages -->
                        @{
                            int start = Math.Max(1, Model.CurrentPage - 2);
                            int end = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
                            if (start > 1)
                            {
                                queryParams["page"] = "1";
                                var firstPageUrl = "?" + string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={kvp.Value}"));
                                <li class="page-item"><a class="page-link" href="@firstPageUrl">1</a></li>
                                if (start > 2)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                            }

                            for (int i = start; i <= end; i++)
                            {
                                queryParams["page"] = i.ToString();
                                var pageUrl = "?" + string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={kvp.Value}"));
                                <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                    <a class="page-link" href="@pageUrl">@i</a>
                                </li>
                            }

                            if (end < Model.TotalPages)
                            {
                                if (end < Model.TotalPages - 1)
                                {
                                    <li class="page-item disabled"><span class="page-link">...</span></li>
                                }
                                queryParams["page"] = Model.TotalPages.ToString();
                                var lastPageUrl = "?" + string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={kvp.Value}"));
                                <li class="page-item"><a class="page-link" href="@lastPageUrl">@Model.TotalPages</a></li>
                            }
                        }

                        <!-- Next -->
                        <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                            @{
                                queryParams["page"] = (Model.CurrentPage + 1).ToString();
                                var nextUrl = "?" + string.Join("&", queryParams.Select(kvp => $"{kvp.Key}={kvp.Value}"));
                            }
                            <a class="page-link" href="@(Model.CurrentPage == Model.TotalPages ? "#" : nextUrl)" aria-label="Next">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

    </div>
</div>